# Intact mass Server 

## Motivation 

A biopharmaceutical is a biological medical product extracted from a biological source. The most
significant fraction of available biopharmaceuticals are monoclonal antibodies (mAbs) prescribed
for different kinds of cancers or autoimmune diseases. Currently, next to the mRNA vaccinations
against Covid-19, mAbs are being developed to treat infected persons with severe disease
progression. These proteins can have different glycosylations and modifications. Compared to
chemical-based pharmaceutics, proteins have a high molecular weight. Hence the likelihood of
causing unwanted modification during the development and manufacturing is higher. These
modifications can lead to reduced potency or, in the worst case causing side effects.
Because of the higher complexity, advanced physio-chemical analytical methods are required to
analyze these proteins to identify impurities, possibly caused by the modifications.
Mass spectrometry (MS) plays a significant role in different applications like intact mass analysis
and peptide mapping.
MS is an analytical technique that is used to measure the mass-to-charge ratio of ions. The results
are typically presented as a mass spectrum, a plot of intensity as a function of the mass-to-charge
ratio. MS is used to identify the different modifications of the proteins because these modifications
are changing the unmodified protein mass.
Intact mass analysis regenerates two sets of data. One originates from the liquid chromatography
(LC) hyphenated to the mass spectrometer (MS) instrument. The second set is a set of MS spectra
generated continuously while the LC is running. The signal processing of the chromatogram
generated by the LC is fundamental. It only requires a low number of peak picking to identify their
start and end to sum the corresponding mass spectra up. The MS spectrum itself requires advanced
signal processing algorithms because next to the peak picking, a deconvolution algorithm needs to
be applied to compute the intact mass out of signal peaks, each representing a charge state of the
protein. Next to commercially available software for deconvolution like Waters` MassLynx,
Thermo`s BiopharmaFinder, and ProeteinMectrics, open-source solutions like UniDec and
FLASHDeconv are also available. Software to analyze analytical data requires data integrity, ideally
from data acquisition until result reporting. The named solutions above only are offering one
processing step. The results from one tool are forwarded to the next tool for further processing.
Solutions that provide data integrity are only offered by some vendors only applicable to data files
acquired on their instruments. Furthermore, these solutions are monolithic and only suitable for
predefined purposes.


## Outline of Contribution

In this work, we aim to provide a vendor-independent and extendable solution by maintaining data
integrity. Having an extendible system closes a gap pharmaceutical companyâ€™s face developing new
formats of protein therapeutics. Especially biopharmaceutical development needs this agility
considering how ordinary mABs are increasingly replaced by more complex constructs like
bispecifics, single-chain Fvs, and peptide fusions. Lastly, we aim to optimize the open-source
solutions to compute the intact mass of existing biotherapeutics generating no artifacts.

## Architecture 

Microservices is an architectural style that structures an application as a collection of services that are

- Highly maintainable and testable
- Loosely coupled with REST api or consumer/producer
- Independently deployable 
- Owned by a small team
The intact mass server is a microservice. The corresponding user interface can be found in the repo: xyz.

This repo is structred as followed: 

The folder app/main contains four folders. 

The **controller** is handling the incoming requests. This part is also checking, if the provided data are matching to the expected data to run 
the corresponding service.

The **service** folder contains the logical part of this service. The implemented algorithm can be found there. 

The **model** folder contains the database entities and their relations between them. The scheme is generated automatically by the SQLAlchemy library.
If a new microservice has no information to save, this section can be skipped. 

The **util** folder contains functions which are used across the system. 
Dto stands for data transfer objects. Dtos define what kind of informations are expected for a service and what kind of informations are responed. 


All back up microservices should follow this pattern. 

## Technologies 

One of the main technologies is [flask](https://flask.palletsprojects.com/en/2.0.x/). Flask is a micro web framework. Before working on this repository make yourself familiar 
with the basics of flask and their add ons. 

[SQLAlchemy](https://www.sqlalchemy.org/) is used for the database integration. This microservice is expecting a PostgreeSQL database
on localhost, listening to default port 5432 with a database lonza. You can change the settings in the .env file to your needs.

As described in the motivation, a intact mass analysis reqieres two steps. The peak picking from the LC and the deconvolution on the MS. For the peak picking. 
For the automatic peak picking the [mMass](https://github.com/chhh/mmass) library is integreted. For the deconvolution [UniDec](https://github.com/michaelmarty/UniDec) is used.  
For further information, please have a look on the section installation.  


## Installation 

A python version of 3.7 >= is required. The creation of a anaconda enviorement is suggested. For installing the dependency run: 


```console
pip istall -r requirements.txt
```

Having UniDec and mMass in your enviorement is mandetory. For adding them into your enviorement go to the repository xyz and run the following command: 


```console
cp -r UniDec /path/to/your/python/enviorement/python3.x/site_packages/UniDec
cp -r mspy /path/to/your/python/enviorement/python3.x/site_packages/mspy
```

## Deploying

There are two ways to deploy this service: 

- run:
    export $(cat .env | xargs)
    python manage.py 

- use the dockerfile: 
    docker build . -t intact_server
    docker run intact_server 


- for starting the whole system with frontend, database and reverse proxy run the docker-compose file: 
    docker-compose up --build -d 


